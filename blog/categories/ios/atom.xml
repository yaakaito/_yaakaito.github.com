<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Category: iOS | yaakaito.org]]></title>
  <link href="http://yaakaito.org/blog/categories/ios/atom.xml" rel="self"/>
  <link href="http://yaakaito.org/"/>
  <updated>2013-04-04T10:29:32+09:00</updated>
  <id>http://yaakaito.org/</id>
  <author>
    <name><![CDATA[yaakaito]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[MagicalRecordの始め方忘れたので思い出しながら書く]]></title>
    <link href="http://yaakaito.org/blog/2013/04/01/magical-record-setup/"/>
    <updated>2013-04-01T00:49:00+09:00</updated>
    <id>http://yaakaito.org/blog/2013/04/01/magical-record-setup</id>
    <content type="html"><![CDATA[<p>こんにちは！うきょーです！
<a href="https://github.com/magicalpanda/MagicalRecord">MagicalRecord</a>使うかーと思ったけど、やりかた覚えてなかったので書く！やっぱブログ書かないと駄目ですね。</p>

<h2>プロジェクト作る</h2>

<p><code>Use Core Data</code> をチェックする</p>

<h2>xcdatamodeldをいじる</h2>

<p>とりあえずサンプルとして</p>

<p>```
Book:
  name: string
  bookId: integer 16
  authors: [Author]</p>

<p>Author:
  name: string
  type: string
  book: [Book]
```</p>

<p>という感じにした、<code>Book</code>と<code>Author</code>は一対多なので、<code>To-Many Relationship</code>を設定する。</p>

<p><img src="/images/mr-to-many.png"></p>

<p><code>Class</code>とかも忘れずに設定する。</p>

<p><img src="/images/mr-class.png" width="240"></p>

<h2>エンティティのモデルクラス作る</h2>

<p><a href="http://rentzsch.github.com/mogenerator/">mogenerator</a>を使うのが一般的っぽいですが、僕は別に使わなくていいかなーと思ってます。
というのも、mogeneratorって「自動生成されるやつだと変更したあとにマージが大変・・・、なのでCoreDataとビジネスロジックをカテゴリで分ける」的な使われ方をするのかなーと思ってるんだけど、それってそりゃそーじゃね、と思うのです。</p>

<p>僕は、CoreDataから出てきたものは、いうならJSON形式のレスポンスをそのまま<code>NSDicitionary</code>として使ってるのとそんなに違わないよなーと思っていて、なので内部的に<code>NSManagedObject</code>をもってるビジネスロジックを担当するクラスを作ればいいと思う。</p>

<p>とはいえただの決めの問題だし、どっちにしろmogenerator使えば楽出来ることに変わりはないと思うので、mogenerator使っときます。(ていうかこれじゃないと駄目なんだっけ？大丈夫だよね？)</p>

<p>(入ってない人は)<code>brew</code>でmogeneratorをインストールします。</p>

<p><code>
$ brew install mogenerator
</code></p>

<p>mogeneratorが吐き出すクラスを入れるディレクトリなんかを作る。とりあえず <code>CoreData</code> とかにしておく。</p>

<p>準備したらmogeneratorでクラスを吐き出す。</p>

<p><code>
$ mogenerator -m [YourCoreData].xcdatamodeld/[YourCoreData].xcdatamodel -O CoreData/ --template-var arc=true
</code></p>

<p>こんな感じ！ <code>--template-var arc=true</code> 付けないとARC用のコードが出てこないっぽいので注意。</p>

<h2>MagicalRecord入れる</h2>

<p><code>
pod `'MagicalRecord'
</code></p>

<p><code>
$ pod install
</code></p>

<p>いい時代になりましたね。</p>

<h2>MagicalRecord使う</h2>

<p>インポートします。</p>

<p>```objective-c</p>

<h1>define MR_SHORTHAND 1</h1>

<h1>import "CoreData+MagicalRecord.h"</h1>

<p>```</p>

<p>セットアップします。</p>

<p><code>objective-c
[MagicalRecord setupCoreDataStackWithStoreNamed:@"YourCoreData.sqlite"];
</code></p>

<p>使います。</p>

<p>```objective-c
MGBook *book = [MGBook createEntity];
book.name = @"Objective-C";
book.bookId = @(123);</p>

<p>[context saveToPersistentStoreAndWait];
```</p>

<p>簡単ですね！</p>

<p>いつの間にか <code>MR_save</code> じゃなくて、<code>MR_saveToPersistentStoreAndWait</code> と <code>MR_saveToPersistentStoreWithCompletion:</code> になったんですね。こっちの方がいいと思います！！！！</p>

<h2>sqliteのビュアーとか</h2>

<p><a href="https://itunes.apple.com/jp/app/liya/id455484422?mt=12">Liya</a>がおすすめですかね。</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Overline0.2.0とBlocksKit併用版を公開しました]]></title>
    <link href="http://yaakaito.org/blog/2013/03/30/overline-020-release/"/>
    <updated>2013-03-30T19:13:00+09:00</updated>
    <id>http://yaakaito.org/blog/2013/03/30/overline-020-release</id>
    <content type="html"><![CDATA[<p>こんにちは！うきょーです！
Objective-C用ユーティリティ、<a href="https://github.com/yaakaito">Overline</a> 0.2.0を公開しました。0.1.5は6時間くらいの命でした。
同時に0.1.xで問題になっていたBlocksKitと一緒に使うとassertで死ぬ問題を回避した、Overline-BlocksKitを公開しています。</p>

<h2>BlocksKitと一緒に使う場合</h2>

<p>Overline-BlocksKitを利用します。Podfileはこんな感じ。</p>

<p><code>
pod 'BlocksKit'
pod 'Overline-BlocksKit'
</code></p>

<p>重複を解決するために、いくつかショートハンドのメソッドを削除しています。
削除されているのは、<code>NSArray</code> <code>NSDictionary</code> <code>NSSet</code> にある以下のメソッドです。</p>

<ul>
<li><code>each:</code></li>
<li><code>map:</code></li>
<li><code>reduce:memo:</code></li>
<li><code>filter:</code></li>
<li><code>reject:</code></li>
</ul>


<p>ショートハンドは削除されますが、Objective-Cっぽい方はそのまま使えます。このあたりはBlocksKitが実装してくれているので、そちらをご利用ください。</p>

<h2>追加された機能とか</h2>

<p>たらたらと紹介していきます。全部書くのはだるいので全部じゃないです。0.1.0から0.2.0までの変更のうちいろいろという感じです。</p>

<h3>NSArray arrayWithRange</h3>

<p>指定した範囲のNSArrayを作ります、NSNumber自体が使いにくいので、あんまり使わないですかね。</p>

<p><code>objective-c
NSArray *array = [NSArray arrayWithRangeFrom:0 to:10];
// @[@0, @1, @2, @3, @4, @5, @6, @7, @8, @9]
</code></p>

<p>逆方向にも行けます</p>

<p><code>objective-c
NSArray *array2 = [NSArray arrayWithRangeFrom:0 to:-10 step:2];
// @[@0, @-2, @-4, @-6, @-8]
</code></p>

<h3>NSArray uniqueObjects</h3>

<p>まんま、ユニークなものだけ返ってきます。</p>

<p><code>objective-c
NSArray *uniqueObjects = [@[@1, @2, @3, @1, @3, @4, @5] uniqueObjects];
// @[@1, @2, @3, @4, @5]
</code></p>

<p>比較の部分をBlocksで書ける <code>uniqueObjectsUsingEqualsBlock:</code> もあります。</p>

<h3>その他NSArray</h3>

<p><code>subArray</code> <code>diffrence</code> <code>reversed</code> とかが地味に増えました。</p>

<h3>NSDictionary arrayMap</h3>

<p>そもそも<code>map</code>おかしくね？となって、追加した。</p>

<p>```objective-c
[@{</p>

<pre><code>@"a" : @1,
@"b" : @2,
@"c" : @3,
@"d" : @4
</code></pre>

<p>} mappedArrayUsingBlock:<sup>(id</sup> obj, NSString *key) {</p>

<pre><code>return @([obj integerValue] * 2);
</code></pre>

<p>}];
// @[@2,@4,@6,@8]
```</p>

<h3>NSDictionary objectForKey:transformBlock: pathForKey:</h3>

<p><code>objectForKey:</code>したあとに変換してーというのが面倒なので、Blocksでまとめられるようにしました。</p>

<p>```objective-c
NSDate *date = [JSON objectForKey:@"date8601" transformBlock:<sup>id(id</sup> obj) {</p>

<pre><code>NSDateFormatter *formatter = [[NSDateFormatter alloc] init];
[formatter setDateFormat:@"yyyy/MM/dd HH:mm:ss Z"];
return [formatter dateFromString:obj];
</code></pre>

<p>}];
```</p>

<p>とか、あとは<code>stringForKey:</code> <code>dateForKey:usingFormat:</code> <code>bookForKey:withTrueValue:</code> <code>integerForKey:</code> などもろもろ。多いのでREADMEかテストを見てください。</p>

<p><code>objectForPath:</code> は <code>hoge.fuga</code> みたいなので階層を辿れる。 <code>valueForKey</code> とか <code>valueForKeyPath</code> でも出来たはずだけど、本来その目的に使う物ではないはずなので、あんまり使っちゃ駄目だと思います。</p>

<p>こっちの<code>transform</code>とかの対応そういえばやってなかった・・・</p>

<p>多分大きめなのはこれくらいかと思います。はい。</p>

<h2>よろしくね！</h2>

<p><a href="https://github.com/yaakaito">Overline</a></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[OverlineにNSDateFormatter系のショートハンドを追加したいのだが]]></title>
    <link href="http://yaakaito.org/blog/2013/03/28/overline-nsdateformatter-shorthands/"/>
    <updated>2013-03-28T02:26:00+09:00</updated>
    <id>http://yaakaito.org/blog/2013/03/28/overline-nsdateformatter-shorthands</id>
    <content type="html"><![CDATA[<p>こんにちは！うきょーです！
<a href="https://github.com/yaakaito/Overline/">Overline</a>であんまり気が向かなかった<code>NSDateFormatter</code>系のところに手をつけ始めました。
わりと意見を求めている記事です。</p>

<p>といっても、そんなにやることはないかなーとか思っていて、<code>NSDateFormatter</code>をそのまま使っちゃって、あれ・・・和暦・・・みたいなトラップを意識的に回避できればそれでよいのかなーと思ってます。</p>

<p>んで、以下の２つのメソッドを追加した。</p>

<p>```objective-c
+ (instancetype)dateFormatterWithCalendarIndetifiter:(NSString *)calendar</p>

<pre><code>                               LocaleIdentifiter:(NSString *)locale
                            timeZoneAbbreviation:(NSString *)timeZone;
</code></pre>

<ul>
<li>(instancetype)userDefaultFormatter;
```</li>
</ul>


<p>１個目はカレンダー、ロケール、タイムゾーンを忘れずに設定してね、というのを明確にするために作ったメソッド。
なんかこの辺は設定するかなーというものを引数にとってる。</p>

<p>２個目は、デフォルトのものを返してくるよ、というもの。
つまりは単純に<code>alloc init</code>した状態のものなんだけど、そもそもの話その状態が分かりにくいんだよ・・・ってことで名前を付けたもの。
ちょっとは分かりやすくなるのかなーと思ってる。</p>

<h2>意見があったらほしいです</h2>

<p>僕はこれでよいかなーとか思っているのですが、これあったほうがいいだろJKとか、いやそれは違う、というのがあれば意見をもらいたいです。
Twitterとかはあんまり追ってないので、下のDisqusにもらえるとありがたいです。</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Hosted CIでiOSライブラリ(Overline)のテスト回してみた]]></title>
    <link href="http://yaakaito.org/blog/2013/03/15/hosted-ci-with-ocunit/"/>
    <updated>2013-03-15T02:05:00+09:00</updated>
    <id>http://yaakaito.org/blog/2013/03/15/hosted-ci-with-ocunit</id>
    <content type="html"><![CDATA[<p>こんにちは！うきょーです。
<a href="https://hosted-ci.com/">Hosted CI</a>という、なんとMac環境でのJenkinsをホスティングしてくれるという超絶便利サービスがあるのですが、
そこで<a href="https://github.com/yaakaito/overline">Overline</a>のテストを回してみました。(Hosted CIはまだベータ版みたいです。)</p>

<p>参考までに、というかいろいろありそうなので、書いた時点でのOverlineの開発環境を先に乗せておきます。</p>

<ul>
<li>OS 10.7.5</li>
<li>AppCode 1.6</li>
<li>Xcode 4.5</li>
<li>Cocoapods 0.15.2

<ul>
<li>OCHamcrest 1.9</li>
</ul>
</li>
</ul>


<p>コードはAppCodeで書いています。(Hosted CI関係ないけどAppCodeの問題もあったので下に書きます)
テストはSenTestingKit + OCHamcrest。
いろいろあってメインマシンでやらなかったので、ちょっと古いです。</p>

<h2>Hosted CI へ登録する</h2>

<p>OpenSourceだしfree planで登録しました。
ちょっと時間がかかったので、先にローカルでやれることをやっておきます。</p>

<h2>ローカルでテストをビルドする</h2>

<p>とりあえずローカルでテストがビルドできないと話にならないので、そっちを確認します。
Cocoapods込みで<code>xcodebuild</code>するのが思えば始めてだったので、ちょっと面倒でした。</p>

<p>まずテスト用のSchemeを作ります。
ビルドの設定へ<code>Jenkins</code>という名前のschemeを定義してあげます。</p>

<p><img src="/images/appcode-jenkins-scheme.png"></p>

<p>ところでこのschemeをjenkinsから使うのかと思ったんですが、実はいらなかったので、自身のある人はやらなくてよいかもしれません。
作ったら<code>xcodebuild</code>で<code>-list</code>してみましょう。</p>

<p>```
$ xcodebuild -workspace Overline.xcworkspace -list
Information about workspace "Overline":</p>

<pre><code>Schemes:
    ...
    Jenkins
</code></pre>

<p>```</p>

<p>こんな感じに出てきたら準備完了です。<code>xcodebuild</code>で<code>Jenkins</code>のshcemeをビルドします</p>

<p><code>
$ xcodebuild -workspace Overline.xcworkspace -scheme 'Jenkins' -configuration 'Debug' -sdk iphonesimulator clean build
</code></p>

<h2>Hosted CI へログイン</h2>

<p>登録できたっぽいメールがきたので、Hosted CI へログインしましょう！ログインするとDashboardが出てきます。何個かプロジェクトがありますね。</p>

<p><img src="/images/hosted-ci-dashboard.png"></p>

<p>下の方にある Create new project からプロジェクトを追加します。</p>

<p><img src="/images/hosted-ci-create.png"></p>

<h2>プロジェクトの作成</h2>

<p>新しいプロジェクトのセットアップを始めます。</p>

<p><img src="/images/hosted-ci-new-project.png"></p>

<p>おおーここから大まかな設定は出来るのかー。便利だなー。
けどスクリプトとかどうせ書くんだろうしだるいなぁ、とか思いながらセットアップして、 Create Project します。さて次はめんどうな・・・</p>

<p><img src="/images/hosted-ci-config-xcode.png"></p>

<p>なん・・・だと・・・</p>

<p><img src="/images/hosted-ci-selected-target.png"></p>

<p>こいつは・・・まさか・・・ 力強くUpdateします。</p>

<p><img src="/images/hosted-ci-created-project.png"></p>

<p>プロジェクトのページができます。ビルドします。</p>

<p><img src="/images/hosted-ci-jenkins-console.png"></p>

<p><img src="/images/hosted-ci-test-complete.png"></p>

<p>俺の知ってるJenkins+iOSと違う・・・。</p>

<p>という感じで拍子抜けするくらい簡単にセットアップが出来てしまいました。
(正確にはAppCodeの問題で2~3回ビルドしたんですが、それは後述します。)</p>

<p>なにげにPodfileのサポートとかも入っててすごい・・・。</p>

<h2>GithubにPushしたときにHookでテスト</h2>

<p>HookのURLが提供されているので、それを使います。プロジェクトのページにあります。</p>

<p><img src="/images/hosted-ci-github-hook.png"></p>

<p>あとはGithubからJenkins Hook URL を設定して終わりです。</p>

<p><img src="/images/github-jenkins-hook.png"></p>

<h2>と、というわけで</h2>

<p>あっさり動いてしまいましたね・・・？</p>

<p><img src="http://tiqav.com/et.jpg"></p>

<p>あ、いや本当に超絶素晴らしいサービスだと思いますし、フィードバックなどしつつ使わせて頂こうと思います、はい。</p>

<h2>【おまけ】AppCode使っててうまくいかなかった話</h2>

<p>Cocoapodsを使うときに、</p>

<p><blockquote><p>[!] Xcodeproj doesn't know about the following attributes lastKnownFileTypetext for the 'PBXGroup' isa.</p></blockquote></p>

<p>こういう感じになってしまったので、何かなーと思ったら、</p>

<p><blockquote><p>Overline これにはまってた  "Problematic attribute added to PBXGroup when renaming group using AppCode : OC-5881"  http://bit.ly/13XdHU8</p><footer><strong>@azu_re</strong> <cite><a href='https://twitter.com/azu_re/status/312065250436456448'>twitter.com/azu_re/status/&hellip;</a></cite></footer></blockquote></p>

<p>というのを見つけて、<a href="http://bit.ly/13XdHU8">リンク先</a>見てみたらどうもこれっぽい。
<code>lastKnownFileType = text;</code> というのが入ってしまうのだとか。</p>

<p>僕の場合はNSNumberのグループに入ってたので、<a href="https://github.com/yaakaito/Overline/commit/01fbeaf306a56319485e394d56b249bd502cab30">これ消したら</a>なおった。</p>

<p>ありがとうございます。</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[conferenceWithDevelopersが無事に終了しました]]></title>
    <link href="http://yaakaito.org/blog/2013/02/26/thanks-ios-developers/"/>
    <updated>2013-02-26T00:39:00+09:00</updated>
    <id>http://yaakaito.org/blog/2013/02/26/thanks-ios-developers</id>
    <content type="html"><![CDATA[<p>こんにちは！うきょーです！
2/23(土)に<a href="http://conference-with-developers.info/">conferenceWithDevelopers</a>というイベントを開催しました。
当日はたくさんの方にご来場頂き、盛況のうちにイベントを終える事が出来ました。</p>

<p>ご講演頂いたみなさん、ご来場頂いたみなさん、会場を提供していただいたグリー様、そして当日お手伝いをして頂いたスタッフの方、本当にありがとうございました。</p>

<p>運営上至らない点も多くあったと思いますが、今回の反省を糧に次へ繋げていきたいと思います。</p>

<p>何度か「次はあるんですか？」という趣旨の質問を受けました。
これについて現状での回答をしておくと、「続けていきたい」思っています。
ですが、毎月開催できるかと言えばそういう感じではないので、時期なんかに関してはまったくの未定です。
イベントのポジションとして、年に一度のお祭り、とかそういう感じに成長できればよいなぁとぼんやり考えています。
力を貸すよ！という方がいらっしゃいましたら是非お願いしたいとも思っています。</p>

<p>というわけで、簡単ですが一旦の挨拶とさせて頂きます。みなさん、ありがとうございました！</p>

<p>「次回にご期待ください！」</p>
]]></content>
  </entry>
  
</feed>
